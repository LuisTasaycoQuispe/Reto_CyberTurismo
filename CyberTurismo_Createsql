CREATE USER C##CyberTuris IDENTIFIED BY vg_cyberturismo

GRANT CREATE SESSION TO C##CyberTuris;
GRANT CREATE TABLE TO C##CyberTuris;
GRANT CREATE VIEW TO C##CyberTuris;
GRANT CREATE PROCEDURE TO C##CyberTuris;
GRANT CREATE TRIGGER TO C##CyberTuris;
GRANT CREATE SEQUENCE TO C##CyberTuris;
GRANT CREATE SYNONYM TO C##CyberTuris;
GRANT UNLIMITED TABLESPACE TO C##CyberTuris;

-- TABLAS 

Create Table TB_CHOFERES
(
    id_chofer NUMBER GENERATED by default on null as IDENTITY,
    nom_chofer VARCHAR2(50),
    apellido_chofer VARCHAR2(60),
    dni_chofer char(8)
);

CREATE TABLE TB_RUTAS
(
    id_ruta NUMBER GENERATED by default on null as IDENTITY,
    nom_rutas VARCHAR2(50)
);


CREATE TABLE TB_BUSES
(
    id_bus NUMBER GENERATED by default on null as IDENTITY,
    num_placa VARCHAR2(10),
    id_chofer NUMBER,
    id_ruta NUMBER,
    state CHAR(1) DEFAULT 'A'
);



CREATE VIEW Buses_View AS
SELECT  'CDBS-' || LPAD(b.id_bus, 3, '0') AS codigo,
b.id_bus, b.num_placa, 
UPPER(c.apellido_chofer) || ', ' || c.nom_chofer AS nombre_chofer,
r.nom_rutas AS nombre_rutas,
b.id_ruta AS ID_RUTA,
c.dni_chofer as dniChofer,
b.id_chofer AS IdChofer, 
b.state 
FROM tb_buses b
INNER JOIN tb_choferes c ON b.id_chofer = c.id_chofer 
INNER JOIN tb_rutas r ON b.id_ruta = r.id_ruta 
where b.STATE ='A' ORDER BY ID_BUS DESC;
